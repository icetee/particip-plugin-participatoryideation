<#include "manageideation_idee_tabs.html" />
<@tabs tab="idee" />

<@rowBox>
    <@boxHeader i18nTitleKey="participatoryideation.manage_idees.tableLabel">
        <@headerButtons>

        
        <form class="form-inline pull-right" method="post" name="manage_idees" action="jsp/admin/plugins/participatoryideation/ManageIdees.jsp">
            <!-- Add pull-right to class1 -->
            <@actionButtons button1Name="view_initIdee" icon1="icon-plus icon-white" i18nValue1Key="participatoryideation.manage_idees.buttonAdd" />
       		  <a href="jsp/admin/plugins/extend/ViewExtenderInfo.jsp?extenderType=comment&idExtendableResource=*&extendableResourceType=IDEE&from_url=jsp/admin/plugins/participatoryideation/ManageIdees.jsp"
               class="btn btn-primary btn-small" title="#i18n{participatoryideation.manage_idees.viewComments}" >
                <i class="fa fa-comments">#i18n{participatoryideation.manage_idees.viewAllComments}</i>
            </a>	
        </form>
        <@paginationAdmin paginator=paginator combo=1 />
        
    </@headerButtons>
    </@boxHeader>

		<div class="row" >
		<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <div class="well">
            <@messages infos=infos />

        <form method="post" action="jsp/admin/plugins/participatoryideation/ManageIdees.jsp">
        <legend>Recherche</legend>

        <div class="row">
        <div class="col-xs-12 col-sm-4 col-md-3 col-lg-3">
            <div class="form-group">
                <label for="filter_titre_ou_description">Text libre, Titre, Description ou r&eacutef&eacuterence :</label>
                <input type="text" class="form-control input-xs" name="filter_titre_ou_description" value="${filter_titre_ou_description!''}">
            </div>
        </div>
        </div>
        
        <div class="row">
        <div class="col-xs-12 col-sm-4 col-md-3 col-lg-3">
            <div class="form-group">
                <label for="filter_code_campagne">Campaign :</label>
                <select id="filter_code_campagne" name="filter_code_campagne" class="form-control input-xs">
                <option value="" <#if !filter_code_campagne??>selected="selected"</#if><option>
                <#list global_static?keys as key>
	                <#assign campaign = global_static[key].campagne>
	                <option value="${campaign.code}" <#if filter_code_campagne?? && campaign.code==filter_code_campagne> selected="selected"</#if>>${campaign.name}</option>
                </#list>
                </select>
            </div>
            <div class="form-group">
                <label for="filter_handicap">Handicap :</label>
                <select id="filter_handicap" name="filter_handicap" class="form-control input-xs">
	                <option value="" <#if !filter_handicap??>selected="selected"</#if><option>
	                <#list handicap_list as handicap >
		                <option value="${handicap.code}" <#if filter_handicap?? && handicap.code==filter_handicap> selected="selected"</#if>>${handicap.name}</option>
	                </#list>
                </select>
            </div>
        </div>
        <div class="col-xs-12 col-sm-4 col-md-3 col-lg-3">
            <div class="form-group">
                <label for="filter_code_theme">Theme :</label>
                <select id="filter_code_theme" name="filter_code_theme" class="form-control input-xs">
	                <option value="" <#if !filter_code_theme??>selected="selected"</#if><option>
	                <#list global_static?keys as key>
		                <#list global_static[key].theme_list as theme>
			                <option value="${theme.code}" <#if filter_code_theme?? && theme.code==filter_code_theme> selected="selected"</#if>>${theme.name}</option>
		                </#list>
	                </#list>
                </select>
            </div>
            <div class="form-group">
                <label for="filter_type_localisation">#i18n{participatoryideation.manage_idees.columnLocalisationType} :</label>
                <select id="filter_type_localisation" name="filter_type_localisation" class="form-control input-xs">
	                <option value="" <#if !filter_type_localisation??>selected="selected"</#if><option>
	                <#list type_localisation_list as type_localisation >
		                <option value="${type_localisation.code}" <#if filter_type_localisation?? && type_localisation.code==filter_type_localisation> selected="selected"</#if>>${type_localisation.name}</option>
	                </#list>
                </select>
            </div>
        </div>
        <div class="col-xs-12 col-sm-4 col-md-3 col-lg-3">
            <div class="form-group">
                <label for="filter_arrondissement">Arrondissement :</label>
                <select id="filter_arrondissement" name="filter_arrondissement" class="form-control input-xs">
	                <option value="" <#if !filter_arrondissement??>selected="selected"</#if><option>
	                <#list global_static?keys as key>
		                <#list global_static[key].area_list as area >
		                	<option value="${area.code}" <#if filter_arrondissement?? && area.code==filter_arrondissement> selected="selected"</#if>>${area.name}</option>
		                </#list>
	                </#list>
                </select>
            </div>
        </div>
        <div class="col-xs-12 col-sm-4 col-md-3 col-lg-3">
            <div class="form-group">
                <label for="filter_qpvqva">QPV/QVA :</label>
                <select id="filter_qpvqva" name="filter_qpvqva" class="form-control input-xs">
	                <option value="" <#if !filter_qpvqva??>selected="selected"</#if><option>
	               		<#list qpvqva_list as qpvqva >
	                <option value="${qpvqva.code}" <#if filter_qpvqva?? && qpvqva.code==filter_qpvqva> selected="selected"</#if>>${qpvqva.name}</option>
                </#list>
                </select>
            </div>
        </div>

        <div class="clearfix"></div>

        <div class="form-group form-inline">
            <input class="btn btn-primary btn-sm" type="submit" name=action_searchIdee value="Rechercher">
            <input class="btn btn-primary btn-sm" type="submit" name=action_cancelSearch value="Annuler">
            <div class="form-group">
                <label for="sort_column">Colonne Tri :</label>
                <select id="sort_column" name="sort_column" class="form-control input-xs">
                <option value="" <#if !sort_column??>selected="selected"</#if><option>
                <#list [
                    {"code":"reference", "name": "#i18n{participatoryideation.manage_idees.columnReference}"},
                    {"code":"creation_timestamp", "name": "#i18n{participatoryideation.manage_idees.columnCreationTimestamp}"}
                ] as column >
                <option value="${column.code}" <#if sort_column?? && column.code==sort_column> selected="selected"</#if>>${column.name}</option>
                </#list>
                </select>
            </div>
            <div class="form-group">
                <label for="sort_order">ordre :</label>
                <select id="sort_order" name="sort_order" class="form-control input-xs">
                <option value="" <#if !sort_order??>selected="selected"</#if><option>
                <#list [
                    {"code":"ASC", "name": "#i18n{participatoryideation.manage_idees.sortOrderAsc}"},
                    {"code":"DESC", "name": "#i18n{participatoryideation.manage_idees.sortOrderDesc}"}
                ] as order >
                <option value="${order.code}" <#if sort_order?? && order.code==sort_order> selected="selected"</#if>>${order.name}</option>
                </#list>
                </select>
            </div>
        </div>
        </div>

        </form>

        </div>
		</div>
		</div>
    <@boxBody>    
    
    <@table>
        <tr>
            <input type="hidden" id="id" name="id"/>
            <th>#i18n{participatoryideation.manage_idees.columnCreationTimestamp}</th>
            <th>#i18n{participatoryideation.manage_idees.columnReference}</th>
            <th>#i18n{participatoryideation.manage_idees.columnCampagne}</th>
            <th>#i18n{participatoryideation.manage_idees.columnTheme}</th>
            <th>#i18n{participatoryideation.manage_idees.columnTitre}</th>
            <th>#i18n{participatoryideation.manage_idees.columnLocalisationType}</th>
            <th>#i18n{participatoryideation.manage_idees.columnLocalisationArdt}</th>
            <th>#i18n{participatoryideation.manage_idees.columnAdress}</th>
            <th>#i18n{participatoryideation.manage_idees.columnDepositaireType}</th>
            <th>#i18n{participatoryideation.manage_idees.columnQpvQva}</th>
            <th>#i18n{participatoryideation.manage_idees.columnParents}</th>
            <th>#i18n{participatoryideation.manage_idees.columnChilds}</th>
            <th>#i18n{participatoryideation.manage_idees.columnStatus}</th>
            <th>#i18n{participatoryideation.manage_idees.columnExportEudonet}</th>
            <th>#i18n{portal.util.labelActions}</th>
            <th>#i18n{participatoryideation.manage_idees.labelWorkflowState}</th>
            <th>#i18n{participatoryideation.manage_idees.labelWorkflowActions}</th>
        </tr>
        <@tableHeadBodySeparator />
            <#list idee_list as ideeExtra >
            <#assign idee = ideeExtra.idee>
        <tr>
            <input type="hidden" id="id" name="id"/>
            <td>
                ${idee.creationTimestamp}
            </td>
            <td>
                ${idee.reference}
            </td>
            <td>
                ${(global_static[idee.codeCampagne].campagne.title)!idee.codeCampagne}
            </td>
            <td>
                <#if (idee.codeTheme)??>
                <#assign theme_title = (global_static[idee.codeCampagne].themes_map[idee.codeTheme].title)!idee.codeTheme>
                </#if>
                ${theme_title!''}
            </td>
            <td>
                ${idee.titre} 
            </td>
            <td>
                ${idee.localisationType!''}
            </td>
            <td>
                ${idee.localisationArdt!''}
            </td>
            <td>
                ${idee.adress!''}
            </td>
            <td>
                <#if (idee.depositaireType)??>
                <#assign depositaire_type_libelle = (global_static[idee.codeCampagne].depositaires_types_map[idee.depositaireType].libelle)!idee.depositaireType>
                </#if>
                ${depositaire_type_libelle!''}
            </td>
            <td>
                <#if idee.typeQpvQva??>${(qpvqva_map[idee.typeQpvQva])!idee.typeQpvQva}<#if idee.libelleQpvQva??> : ${idee.libelleQpvQva!}</#if></#if>
            </td>
            <td>
                <#list idee.parentIdees as parent>${parent.reference} (${parent.titre!})<#if parent_has_next><br/></#if></#list>
            </td>
            <td>
                <#list idee.childIdees as child>${child.reference} (${child.titre!})<#if child_has_next><br/></#if></#list>
            </td>
	        <td>#i18n{${idee.getStatusPublic().getLibelle()}}</td>
	        <td>${idee.exportedTag!}</td>
	        
	        <td>
	            <a href="jsp/admin/plugins/participatoryideation/ManageIdees.jsp?view=modifyIdee&id=${idee.id}"
	               class="btn btn-primary btn-small" title="#i18n{portal.util.labelModify}">
	                <i class="fa fa-pencil"></i>
	            </a>
	            <#if idee.getStatusIsRemoved() == false> 
	            <a href="jsp/admin/plugins/participatoryideation/ManageIdees.jsp?view=confirmRemoveIdee&id=${idee.id}"
	               class="btn btn-danger btn-small" title="#i18n{portal.util.labelDelete}" >
	                <i class="fa fa-trash"></i>
	            </a>
	            </#if>
	            <a href="jsp/admin/plugins/extend/ViewExtenderInfo.jsp?extenderType=comment&idExtendableResource=${idee.id}&extendableResourceType=IDEE&from_url=jsp/admin/plugins/participatoryideation/ManageIdees.jsp"
	               class="btn btn-primary btn-small" title="#i18n{participatoryideation.manage_idees.viewComments}" >
	                <i class="fa fa-comments"></i>
	            </a>
	            <a href="jsp/admin/plugins/participatoryideation/DoExportCsvIdeeUsers.jsp?id=${idee.id}"
	               class="btn btn-primary btn-small" title="#i18n{participatoryideation.manage_idees.labelExportCSV}">
	                <i class="fa fa-download"></i>
	            </a>
	        </td>
	        
	        <#-- Display workflow state and actions for current proopsal -->
	        <td>
		        <#if workflow_state_map??>
		        	${(workflow_state_map[""+idee.id].name)!'No state'}
		        <#else>
		        	Disabled workflow
		        </#if>
		    </td>
	        <td>
	        <td>
		        <#if workflow_actions_map?? && workflow_actions_map[""+idee.id]?? >
		        	<#list workflow_actions_map[""+idee.id] as action >
					    <a class="btn btn-primary" href="jsp/admin/plugins/participatoryideation/ManageIdees.jsp?action=processWorkflowAction&id_action=${action.id}&id_resource=${idee.id}" title="${action.name}" >
					        <img src="image?resource_type=workflow_icon_img&id=${action.icon.id}"
					            <#if action.icon.width!=-1> width="${action.icon.width}"</#if>
					            <#if action.icon.height!=-1> height="${action.icon.height}"</#if>
					            alt="${action.name}"/>
					     </a>
					</#list>
		        <#else>
		        	No actions
		        </#if>
		    </td>
        </tr>
        </#list>
    </@table>

    <@paginationAdmin paginator=paginator />

  </@boxBody>
</@rowBox>

<script type="text/javascript">
    
    $(document).ready( function(){
        var description = $('#description') ;

        description.text(description.text().substring(0,50));
    });
</script>